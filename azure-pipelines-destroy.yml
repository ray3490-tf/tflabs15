# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none

pool: my-personal-computer

variables:
  bkstrgrg: 'azDevTFTestrg01'
  bkstrg: 'racrazdevopstest01'
  bkcontainer: 'tfstate'
  bkstrkey: 'devpipeline.terraform.tfstate'

stages:
  - stage: tfdestroy
    jobs: 
      - job: destroy
        steps:
           - task: TerraformInstaller@1
             displayName: tfinstall
             inputs:
              terraformVersion: 'latest'
           - task: TerraformTask@5
             displayName: initialize terraform
             inputs:
              provider: 'azurerm'
              command: 'init'
              backendServiceArm: 'DevTestServiceConnection'
              backendAzureRmResourceGroupName: '$(bkstrgrg)'
              backendAzureRmStorageAccountName: '$(bkstrg)'
              backendAzureRmContainerName: '$(bkcontainer)'
              backendAzureRmKey: '$(bkstrkey)'
           - task: TerraformTask@5
             displayName: plan
             inputs:
               provider: 'azurerm'
               command: 'plan'
               environmentServiceNameAzureRM: 'DevTestServiceConnection'
           - task: TerraformTask@5
             displayName: destroy 
             inputs:
               provider: 'azurerm'
               command: 'destroy'
               environmentServiceNameAzureRM: 'DevTestServiceConnection'
    